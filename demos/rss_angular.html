<!DOCTYPE html>
<html ng-app="RSS_Demo">
<head>
	<title>RSS Demo using AngularJS</title>

<link rel="stylesheet" href="../bootstrap/css/bootstrap.css" type="text/css">
<link rel="stylesheet" href="../bootstrap/css/bootstrap-responsive.css" type="text/css">

<style>
body {
	padding: 0 30px;
}
@media screen and (max-width: 640px) {
	body {
		padding: 0 10px;
	}
}

.well .rssThumb img {
	width: 132px;
	margin: 0 16px 4px 0;
}

.modal-body {
	max-height: 600px;
}

#vPlayer {
	display: block;
	margin:0 auto 10px auto;
	width: 512px;
	height: 288px;
}

#vidTagAlert {
	text-align:center;
	display:none;
}

#aboutInfo .dropdown-menu {
	padding:10px;
	left:-100%;
}
#aboutInfo p.pull-right {
	text-align: right;
	margin-bottom: 0
}
</style>

</head>
<body ng-controller="AppCtrl" ng-init="init()">

<div id="aboutInfo" class="pull-right">
	<div class="dropdown">
		<a id="dropInfo" role="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">About this page</a>
		<div class="dropdown-menu small" aria-labelledby="dropInfo">

			<p>Media RSS demo using <a href="http://angularjs.org/" target="_blank">AngularJS</a>, <a href="https://developers.google.com/feed/" target="_blank">Google Feeds API</a>, <a href="http://jquery.com/" target="_blank">jQuery</a> and <a href="http://twitter.github.io/bootstrap/" target="_blank">Twitter bootstrap</a>.</p>

			<p class="pull-right" style=""><em>by <a href="http://www.wingo.com/services.html" title="wingo.com">Joseph Oster</a>, April 2013</em><br>
			<a href="http://www.wingo.com/services.html" title="wingo.com Web Site Design"><img src="../images/wsb.gif" width="111" height="40" alt="wingo.com Web Site Design" /></a></p>

		</div>
	</div>
</div>

<h1 ng-cloak><a href="{{feed_result.link}}" target="_blank">{{feed_result.title}}</a></h1>

<p ng-cloak>{{feed_result.description}}</p>

<div class="well well-small" ng-repeat="entry in feed_result.entries" init-tooltips ng-cloak>
	<a ng-click="playVideo(entry)" href="#" class="pull-left rssThumb" onclick="return false;" title="play video" data-toggle="tooltip"><img ng-repeat="thumbnail in entry.mediaGroups[0].contents[0].thumbnails" src="{{thumbnail.url}}"></a>

	<h4><a href="{{entry.link}}" target="_blank" title="view at TED.com" data-toggle="tooltip">{{entry.title}}</a></h4>

	<button ng-click="playVideo(entry)" class="btn btn-primary pull-left" style="margin: 0 10px 10px 0">Play</button>

	<p>{{entry.contentSnippet}}</p>

	<p class="muted">
		Posted: {{entry.publishedDate}} -
		<span class="label label-info" ng-repeat="category in entry.categories">{{category}}</span>
	</p>
</div>

<div class="modal hide fade" id="videoModal">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3>RSS Video demo</h3>
	</div>
	<div class="modal-body">

		<div id="vidTagAlert" class="alert alert-error">
			<button type="button" class="close" id="btnTagAlert">&times;</button>
			<strong>FAIL!</strong> The HTML5 &lt;video&gt; tag does not support .mp4 videos in Chrome and Firefox. Use Internet Explorer or Safari to watch these videos.
		</div>

		<video id="vPlayer" src="{{currEntry.mediaGroups[0].contents[0].url}}" controls autoplay></video>

		<p><span class="lead">{{currEntry.title}}</span><br>
			<span ng-bind-html="currEntry.content"></span>
		</p>

		<p class="muted">Posted: {{currEntry.publishedDate}} - <a href="{{currEntry.link}}" target="_blank" class="text-info" ng-click="stopVideo()">view at TED.com</a></p>
	</div>
</div>



<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="../bootstrap/js/bootstrap.js" type="text/javascript"></script>
<script src="https://www.google.com/jsapi"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.6/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.6/angular-sanitize.min.js"></script>

<script type="text/javascript">
google.load("feeds", "1");

angular.module('RSS_Demo', ['ngSanitize'])

	.directive('initTooltips', function() {
		return function(scope, element, attrs) {
			if (scope.$last) { // init tooltips when all are rendered
				$('a[data-toggle="tooltip"]').tooltip();
			}
		};
	});

function AppCtrl($scope, $q) {

	$scope.playVideo = function(entry) {
		$scope.afterPlay = true; // show errors only after "Play" video
		$scope.currEntry = entry;
		$scope.videoModal.modal();
	}

	$scope.stopVideo = function() {
		$scope.vPlayer.pause();
	}

	$scope.init = function() {
		$scope.videoModal = $('#videoModal');
		$scope.videoModal.on('hidden', function () {
			$scope.stopVideo()
		});

		$scope.vPlayer = $('#vPlayer')[0];
		$($scope.vPlayer).on('error', function () {
			if ($scope.afterPlay) {
				$("#vidTagAlert").show();
			}
		});
		$('#btnTagAlert').on('click', function () {
			$("#vidTagAlert").hide();
		});

		$scope.$watch('currEntry', function () {
			$scope.vPlayer.load();
		});

		var feed = new google.feeds.Feed("http://feeds.feedburner.com/TEDTalks_video");
		feed.setNumEntries(1000);
		feed.load(function(result) {
			$scope.$apply(function() {
				$scope.feed_result = result.feed;
			});
		});
	}

}
</script>

</body>
</html>